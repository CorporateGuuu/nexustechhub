"use strict";(()=>{var e={};e.id=7764,e.ids=[7764],e.modules={8667:(e,s)=>{Object.defineProperty(s,"A",{enumerable:!0,get:function(){return n}});var n=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},15946:(e,s,n)=>{n.a(e,async(e,o)=>{try{n.r(s),n.d(s,{config:()=>d,default:()=>u,routeModule:()=>l});var t=n(33480),r=n(8667),a=n(86435),i=n(29560),c=e([i]);i=(c.then?(await c)():c)[0];let u=(0,a.M)(i,"default"),d=(0,a.M)(i,"config"),l=new t.PagesAPIRouteModule({definition:{kind:r.A.PAGES_API,page:"/api/auth/2fa/send-code",pathname:"/api/auth/2fa/send-code",bundlePath:"",filename:""},userland:i});o()}catch(e){o(e)}})},29560:(e,s,n)=>{n.a(e,async(e,o)=>{try{n.r(s),n.d(s,{default:()=>i});var t=n(75832),r=n(64939),a=e([r]);let c=new(r=(a.then?(await a)():a)[0]).Pool({connectionString:process.env.DATABASE_URL||"postgresql://postgres:postgres@localhost:5432/mdtstech_store",ssl:{rejectUnauthorized:!1}});async function i(e,s){if("POST"!==e.method)return s.status(405).json({message:"Method not allowed"});try{let{userId:n,method:o}=e.body;if(!n||!o||!["email","sms"].includes(o))return s.status(400).json({message:"Invalid request parameters"});let r=`
      SELECT email, phone_number FROM users
      WHERE id = $1
    `,a=await c.query(r,[n]);if(0===a.rows.length)return s.status(404).json({message:"User not found"});let i=a.rows[0],u=!1;if("email"===o){if(!i.email)return s.status(400).json({message:"User does not have an email address"});u=await (0,t.sendEmailVerification)(n,i.email)}else if("sms"===o){if(!i.phone_number)return s.status(400).json({message:"User does not have a phone number"});u=await (0,t.sendSmsVerification)(n,i.phone_number)}if(!u)return s.status(500).json({message:`Failed to send ${o} verification`});return s.status(200).json({message:`${o} verification sent successfully`})}catch(e){return console.error("Error sending verification code:",e),s.status(500).json({message:"Internal server error"})}}o()}catch(e){o(e)}})},33480:(e,s,n)=>{e.exports=n(75600)},64939:e=>{e.exports=import("pg")},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},75832:(e,s,n)=>{n.r(s),n.d(s,{default:()=>y,disable2FA:()=>a,enable2FA:()=>r,generate2FASecret:()=>t,generateBackupCodes:()=>u,generateDuoRequest:()=>l,getUserTwoFactorSettings:()=>i,sendEmailVerification:()=>f,sendSmsVerification:()=>A,sendTwoFactorCode:()=>c,updateUserTwoFactorSettings:()=>p,verify2FA:()=>o,verifyBackupCode:()=>d,verifyCode:()=>m,verifyDuoResponse:()=>g});let o=async(e,s,n="email")=>(console.log(`2FA verification for user ${e} with code ${s} via ${n}`),{success:!0,verified:!0}),t=async e=>(console.log(`Generating 2FA secret for user ${e}`),{secret:"MOCK2FASECRET123456789",qrCode:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=="}),r=async(e,s="email")=>(console.log(`Enabling 2FA for user ${e} via ${s}`),{success:!0,enabled:!0,method:s}),a=async e=>(console.log(`Disabling 2FA for user ${e}`),{success:!0,enabled:!1}),i=async e=>(console.log(`Getting 2FA settings for user ${e}`),{enabled:!1,email_enabled:!1,sms_enabled:!1,duo_enabled:!1,preferred_method:"email",backup_codes_count:0}),c=async(e,s="email")=>(console.log(`Sending 2FA code to user ${e} via ${s}`),{success:!0,sent:!0,method:s,code:"123456"}),u=async e=>{console.log(`Generating backup codes for user ${e}`);let s=[];for(let e=0;e<10;e++)s.push(Math.random().toString(36).substring(2,10).toUpperCase());return{success:!0,codes:s}},d=async(e,s)=>(console.log(`Verifying backup code for user ${e}: ${s}`),{success:!0,verified:!0,remaining_codes:9}),l=async e=>(console.log(`Generating Duo request for user ${e}`),{success:!0,duo_request:"TX|mock-duo-request|mock-app-id",duo_host:"api-mock.duosecurity.com"}),g=async(e,s)=>(console.log(`Verifying Duo response for user ${s}: ${e}`),{success:!0,verified:!0,username:`user_${s}`}),f=async(e,s)=>(console.log(`Sending email verification to ${s} for user ${e}`),{success:!0,sent:!0,code:"123456",expires_at:new Date(Date.now()+3e5).toISOString()}),A=async(e,s)=>(console.log(`Sending SMS verification to ${s} for user ${e}`),{success:!0,sent:!0,code:"654321",expires_at:new Date(Date.now()+3e5).toISOString()}),m=async(e,s,n="email")=>(console.log(`Verifying ${n} code ${s} for user ${e}`),{success:!0,verified:!0,method:n}),p=async(e,s)=>(console.log(`Updating 2FA settings for user ${e}:`,s),{success:!0,settings:{...s,updated_at:new Date().toISOString()}}),y={verify2FA:o,generate2FASecret:t,enable2FA:r,disable2FA:a,getUserTwoFactorSettings:i,sendTwoFactorCode:c,generateBackupCodes:u,verifyBackupCode:d,generateDuoRequest:l,verifyDuoResponse:g,sendEmailVerification:f,sendSmsVerification:A,verifyCode:m,updateUserTwoFactorSettings:p}},86435:(e,s)=>{Object.defineProperty(s,"M",{enumerable:!0,get:function(){return function e(s,n){return n in s?s[n]:"then"in s&&"function"==typeof s.then?s.then(s=>e(s,n)):"function"==typeof s&&"default"===n?s:void 0}}})}};var s=require("../../../../webpack-api-runtime.js");s.C(e);var n=s(s.s=15946);module.exports=n})();