"use strict";(()=>{var e={};e.id=4267,e.ids=[4267],e.modules={8667:(e,s)=>{Object.defineProperty(s,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},33480:(e,s,t)=>{e.exports=t(75600)},33838:(e,s,t)=>{t.a(e,async(e,o)=>{try{t.r(s),t.d(s,{config:()=>l,default:()=>u,routeModule:()=>d});var n=t(33480),r=t(8667),a=t(86435),i=t(69243),c=e([i]);i=(c.then?(await c)():c)[0];let u=(0,a.M)(i,"default"),l=(0,a.M)(i,"config"),d=new n.PagesAPIRouteModule({definition:{kind:r.A.PAGES_API,page:"/api/auth/2fa/duo-init",pathname:"/api/auth/2fa/duo-init",bundlePath:"",filename:""},userland:i});o()}catch(e){o(e)}})},64939:e=>{e.exports=import("pg")},69243:(e,s,t)=>{t.a(e,async(e,o)=>{try{t.r(s),t.d(s,{default:()=>i});var n=t(75832),r=t(64939),a=e([r]);let c=new(r=(a.then?(await a)():a)[0]).Pool({connectionString:process.env.DATABASE_URL||"postgresql://postgres:postgres@localhost:5432/mdtstech_store",ssl:{rejectUnauthorized:!1}});async function i(e,s){if("POST"!==e.method)return s.status(405).json({message:"Method not allowed"});try{let{userId:t}=e.body;if(!t)return s.status(400).json({message:"Invalid request parameters"});let o=`
      SELECT email FROM users
      WHERE id = $1
    `,r=await c.query(o,[t]);if(0===r.rows.length)return s.status(404).json({message:"User not found"});let a=r.rows[0],i=(0,n.generateDuoRequest)(t,a.email);if(!i)return s.status(500).json({message:"Failed to generate DUO request"});return s.status(200).json(i)}catch(e){return console.error("Error initializing DUO:",e),s.status(500).json({message:"Internal server error"})}}o()}catch(e){o(e)}})},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},75832:(e,s,t)=>{t.r(s),t.d(s,{default:()=>y,disable2FA:()=>a,enable2FA:()=>r,generate2FASecret:()=>n,generateBackupCodes:()=>u,generateDuoRequest:()=>d,getUserTwoFactorSettings:()=>i,sendEmailVerification:()=>A,sendSmsVerification:()=>f,sendTwoFactorCode:()=>c,updateUserTwoFactorSettings:()=>m,verify2FA:()=>o,verifyBackupCode:()=>l,verifyCode:()=>p,verifyDuoResponse:()=>g});let o=async(e,s,t="email")=>(console.log(`2FA verification for user ${e} with code ${s} via ${t}`),{success:!0,verified:!0}),n=async e=>(console.log(`Generating 2FA secret for user ${e}`),{secret:"MOCK2FASECRET123456789",qrCode:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=="}),r=async(e,s="email")=>(console.log(`Enabling 2FA for user ${e} via ${s}`),{success:!0,enabled:!0,method:s}),a=async e=>(console.log(`Disabling 2FA for user ${e}`),{success:!0,enabled:!1}),i=async e=>(console.log(`Getting 2FA settings for user ${e}`),{enabled:!1,email_enabled:!1,sms_enabled:!1,duo_enabled:!1,preferred_method:"email",backup_codes_count:0}),c=async(e,s="email")=>(console.log(`Sending 2FA code to user ${e} via ${s}`),{success:!0,sent:!0,method:s,code:"123456"}),u=async e=>{console.log(`Generating backup codes for user ${e}`);let s=[];for(let e=0;e<10;e++)s.push(Math.random().toString(36).substring(2,10).toUpperCase());return{success:!0,codes:s}},l=async(e,s)=>(console.log(`Verifying backup code for user ${e}: ${s}`),{success:!0,verified:!0,remaining_codes:9}),d=async e=>(console.log(`Generating Duo request for user ${e}`),{success:!0,duo_request:"TX|mock-duo-request|mock-app-id",duo_host:"api-mock.duosecurity.com"}),g=async(e,s)=>(console.log(`Verifying Duo response for user ${s}: ${e}`),{success:!0,verified:!0,username:`user_${s}`}),A=async(e,s)=>(console.log(`Sending email verification to ${s} for user ${e}`),{success:!0,sent:!0,code:"123456",expires_at:new Date(Date.now()+3e5).toISOString()}),f=async(e,s)=>(console.log(`Sending SMS verification to ${s} for user ${e}`),{success:!0,sent:!0,code:"654321",expires_at:new Date(Date.now()+3e5).toISOString()}),p=async(e,s,t="email")=>(console.log(`Verifying ${t} code ${s} for user ${e}`),{success:!0,verified:!0,method:t}),m=async(e,s)=>(console.log(`Updating 2FA settings for user ${e}:`,s),{success:!0,settings:{...s,updated_at:new Date().toISOString()}}),y={verify2FA:o,generate2FASecret:n,enable2FA:r,disable2FA:a,getUserTwoFactorSettings:i,sendTwoFactorCode:c,generateBackupCodes:u,verifyBackupCode:l,generateDuoRequest:d,verifyDuoResponse:g,sendEmailVerification:A,sendSmsVerification:f,verifyCode:p,updateUserTwoFactorSettings:m}},86435:(e,s)=>{Object.defineProperty(s,"M",{enumerable:!0,get:function(){return function e(s,t){return t in s?s[t]:"then"in s&&"function"==typeof s.then?s.then(s=>e(s,t)):"function"==typeof s&&"default"===t?s:void 0}}})}};var s=require("../../../../webpack-api-runtime.js");s.C(e);var t=s(s.s=33838);module.exports=t})();