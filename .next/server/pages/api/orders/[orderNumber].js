"use strict";(()=>{var e={};e.id=7198,e.ids=[7198],e.modules={4722:e=>{e.exports=require("next-auth/react")},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return o}});var o=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},10862:(e,t,o)=>{let r;o.r(t),o.d(t,{config:()=>g,default:()=>l,routeModule:()=>m});var a={};o.r(a),o.d(a,{default:()=>u});var s=o(33480),n=o(8667),i=o(86435),d=o(4722);try{r=o(75217)}catch(e){r={query:async()=>({rows:[]})}}let{query:c}=r;async function u(e,t){let o=await (0,d.getSession)({req:e}),{orderNumber:r}=e.query;return r?"GET"===e.method?p(e,t,o?.user?.id||"demo-user",r):t.status(405).json({success:!1,message:"Method not allowed"}):t.status(400).json({success:!1,message:"Order number is required"})}async function p(e,t,o,r){try{let e={id:r,order_number:r,status:"processing",total_amount:249.97,shipping_cost:10,payment_status:"paid",shipping_method:"Standard Shipping",notes:"",created_at:new Date().toISOString(),shipping_address:{name:"Ahmed Al-Rashid",address:"Compass Building, Al Shohada Road",city:"Ras Al Khaimah",state:"AL Hamra Industrial Zone-FZ",zip:"",country:"United Arab Emirates",phone:"+971 58 553 1029",email:"ahmed@example.com"},billing_address:{name:"Ahmed Al-Rashid",address:"Compass Building, Al Shohada Road",city:"Ras Al Khaimah",state:"AL Hamra Industrial Zone-FZ",zip:"",country:"United Arab Emirates",phone:"+971 58 553 1029",email:"ahmed@example.com"},payment_method:{type:"credit_card",card_number:"************4242",card_type:"Visa"},items:[{id:1,product_id:101,product_name:"iPhone 13 Pro OLED Screen",product_price:129.99,quantity:1,discount_percentage:0,total_price:129.99,image_url:"/images/products/iphone-screen.jpg",slug:"iphone-13-pro-oled-screen"},{id:2,product_id:102,product_name:"Professional Repair Tool Kit",product_price:69.99,quantity:1,discount_percentage:0,total_price:69.99,image_url:"/images/products/repair-tools.jpg",slug:"professional-repair-tool-kit"},{id:3,product_id:103,product_name:"iPhone Battery Replacement Kit",product_price:49.99,quantity:1,discount_percentage:0,total_price:49.99,image_url:"/images/products/iphone-battery.jpg",slug:"iphone-battery-replacement-kit"}],status_history:[{status:"placed",notes:"Order received",created_at:new Date(Date.now()-864e5).toISOString()},{status:"processing",notes:"Payment confirmed, preparing for shipment",created_at:new Date(Date.now()-432e5).toISOString()}]};try{let e=await c(`
        SELECT o.id, o.order_number, o.status, o.total_amount,
               o.shipping_address, o.billing_address, o.payment_method,
               o.payment_status, o.shipping_method, o.shipping_cost,
               o.notes, o.created_at
        FROM orders o
        WHERE o.order_number = $1 AND o.user_id = $2
      `,[r,o]);if(e.rows.length>0){let o=e.rows[0],r=(await c(`
          SELECT oi.id, oi.product_id, oi.product_name, oi.product_price,
                 oi.quantity, oi.discount_percentage, oi.total_price,
                 p.image_url, p.slug
          FROM order_items oi
          LEFT JOIN products p ON oi.product_id = p.id
          WHERE oi.order_id = $1
        `,[o.id])).rows.map(e=>({...e,product_price:parseFloat(e.product_price),discount_percentage:parseFloat(e.discount_percentage||0),total_price:parseFloat(e.total_price)})),a=await c(`
          SELECT status, notes, created_at
          FROM order_status_history
          WHERE order_id = $1
          ORDER BY created_at DESC
        `,[o.id]),s={...o,total_amount:parseFloat(o.total_amount),shipping_cost:parseFloat(o.shipping_cost||0),shipping_address:"string"==typeof o.shipping_address?JSON.parse(o.shipping_address):o.shipping_address,billing_address:"string"==typeof o.billing_address?JSON.parse(o.billing_address):o.billing_address,payment_method:"string"==typeof o.payment_method?JSON.parse(o.payment_method):o.payment_method,items:r,status_history:a.rows};return t.status(200).json({success:!0,order:s})}}catch(e){}return t.status(200).json({success:!0,order:e})}catch(e){return t.status(500).json({success:!1,message:"Error getting order"})}}let l=(0,i.M)(a,"default"),g=(0,i.M)(a,"config"),m=new s.PagesAPIRouteModule({definition:{kind:n.A.PAGES_API,page:"/api/orders/[orderNumber]",pathname:"/api/orders/[orderNumber]",bundlePath:"",filename:""},userland:a})},33480:(e,t,o)=>{e.exports=o(75600)},75217:(e,t,o)=>{o.r(t),o.d(t,{createUser:()=>n,default:()=>_,getCategories:()=>l,getCategoryBySlug:()=>p,getConnection:()=>a,getProductBySlug:()=>m,getProducts:()=>g,getUserByEmail:()=>i,getUserById:()=>d,pool:()=>u,query:()=>r,transaction:()=>s,updateUser:()=>c});let r=async(e,t=[])=>(console.log(`Database query: ${e}`,t),{rows:[],rowCount:0}),a=async()=>(console.log("Getting database connection"),{query:r,release:()=>console.log("Connection released")}),s=async e=>{console.log("Starting database transaction");let t=await a();try{await t.query("BEGIN");let o=await e(t);return await t.query("COMMIT"),o}catch(e){throw await t.query("ROLLBACK"),e}finally{t.release()}},n=async e=>(console.log("Creating user:",e),{id:"mock-user-id",...e}),i=async e=>(console.log("Getting user by email:",e),null),d=async e=>(console.log("Getting user by ID:",e),null),c=async(e,t)=>(console.log("Updating user:",e,t),{id:e,...t}),u={query:async(e,t=[])=>(console.log(`Pool query: ${e}`,t),{rows:[],rowCount:0}),connect:async()=>(console.log("Pool connection established"),{query:async(e,t=[])=>(console.log(`Connection query: ${e}`,t),{rows:[],rowCount:0}),release:()=>console.log("Connection released")})},p=async e=>(console.log(`Getting category by slug: ${e}`),{id:1,name:"iPhone Parts",slug:e,description:"High-quality iPhone replacement parts"}),l=async()=>(console.log("Getting all categories"),[{id:1,name:"iPhone Parts",slug:"iphone-parts"},{id:2,name:"Samsung Parts",slug:"samsung-parts"},{id:3,name:"iPad Parts",slug:"ipad-parts"},{id:4,name:"Tools",slug:"tools"}]),g=async(e={})=>(console.log("Getting products with filters:",e),[{id:1,name:"iPhone 15 Pro Screen",slug:"iphone-15-pro-screen",price:299.99,category:"iPhone Parts"},{id:2,name:"Samsung S24 Battery",slug:"samsung-s24-battery",price:89.99,category:"Samsung Parts"}]),m=async e=>(console.log(`Getting product by slug: ${e}`),{id:1,name:"iPhone 15 Pro Screen",slug:e,price:299.99,description:"High-quality OLED screen replacement for iPhone 15 Pro",category:"iPhone Parts"}),_={query:r,getConnection:a,transaction:s,createUser:n,getUserByEmail:i,getUserById:d,updateUser:c,pool:u,getCategoryBySlug:p,getCategories:l,getProducts:g,getProductBySlug:m}},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},86435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,o){return o in t?t[o]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,o)):"function"==typeof t&&"default"===o?t:void 0}}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var o=t(t.s=10862);module.exports=o})();