"use strict";(()=>{var e={};e.id=579,e.ids=[579],e.modules={41649:e=>{e.exports=require("next-auth/react")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},56249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},11845:(e,t,r)=>{r.r(t),r.d(t,{config:()=>m,default:()=>p,routeModule:()=>P});var s={};r.r(s),r.d(s,{default:()=>u});var a=r(71802),n=r(47153),o=r(56249),i=r(41649),c=r(51004);async function u(e,t){let r=await (0,i.getSession)({req:e}),s=r?.user?.id,{sessionId:a}=e.cookies;if(!s&&!a)return t.status(401).json({success:!1,message:"Authentication required"});switch(e.method){case"GET":return d(e,t,s,a);case"POST":return l(e,t,s,a);case"PUT":return g(e,t,s,a);case"DELETE":return y(e,t,s,a);default:return t.status(405).json({success:!1,message:"Method not allowed"})}}async function d(e,t,r,s){try{let e=await E(r,s),a=(await (0,c.query)(`
      SELECT ci.id, ci.quantity, p.id as product_id, p.name, p.price,
             p.discount_percentage, p.image_url, p.slug
      FROM cart_items ci
      JOIN products p ON ci.product_id = p.id
      WHERE ci.cart_id = $1
    `,[e.id])).rows.map(e=>{let t=parseFloat(e.price),r=parseFloat(e.discount_percentage||0),s=r>0?t*(1-r/100):t;return{...e,price:t,discount_percentage:r,discounted_price:parseFloat(s.toFixed(2)),total:parseFloat((s*e.quantity).toFixed(2))}}),n=a.reduce((e,t)=>e+t.total,0);return t.status(200).json({success:!0,cart:{id:e.id,items:a,item_count:a.reduce((e,t)=>e+t.quantity,0),subtotal:parseFloat(n.toFixed(2))}})}catch(e){return console.error("Error getting cart:",e),t.status(500).json({success:!1,message:"Error getting cart"})}}async function l(e,t,r,s){try{let{productId:a,quantity:n=1}=e.body;if(!a)return t.status(400).json({success:!1,message:"Product ID is required"});let o=await (0,c.query)("SELECT id FROM products WHERE id = $1",[a]);if(0===o.rows.length)return t.status(404).json({success:!1,message:"Product not found"});let i=await E(r,s),u=await (0,c.query)("SELECT id, quantity FROM cart_items WHERE cart_id = $1 AND product_id = $2",[i.id,a]);if(u.rows.length>0){let e=u.rows[0],t=e.quantity+n;await (0,c.query)("UPDATE cart_items SET quantity = $1, updated_at = CURRENT_TIMESTAMP WHERE id = $2",[t,e.id])}else await (0,c.query)("INSERT INTO cart_items (cart_id, product_id, quantity) VALUES ($1, $2, $3)",[i.id,a,n]);return d(e,t,r,s)}catch(e){return console.error("Error adding to cart:",e),t.status(500).json({success:!1,message:"Error adding to cart"})}}async function g(e,t,r,s){try{let{itemId:a,quantity:n}=e.body;if(!a||!n)return t.status(400).json({success:!1,message:"Item ID and quantity are required"});if(n<1)return t.status(400).json({success:!1,message:"Quantity must be at least 1"});let o=await E(r,s),i=await (0,c.query)(`UPDATE cart_items
       SET quantity = $1, updated_at = CURRENT_TIMESTAMP
       WHERE id = $2 AND cart_id = $3
       RETURNING id`,[n,a,o.id]);if(0===i.rows.length)return t.status(404).json({success:!1,message:"Cart item not found"});return d(e,t,r,s)}catch(e){return console.error("Error updating cart item:",e),t.status(500).json({success:!1,message:"Error updating cart item"})}}async function y(e,t,r,s){try{let{itemId:a}=e.body;if(!a)return t.status(400).json({success:!1,message:"Item ID is required"});let n=await E(r,s);return await (0,c.query)("DELETE FROM cart_items WHERE id = $1 AND cart_id = $2",[a,n.id]),d(e,t,r,s)}catch(e){return console.error("Error removing from cart:",e),t.status(500).json({success:!1,message:"Error removing from cart"})}}async function E(e,t){let r;return e?0===(r=await (0,c.query)("SELECT id FROM carts WHERE user_id = $1",[e])).rows.length&&(r=await (0,c.query)("INSERT INTO carts (user_id) VALUES ($1) RETURNING id",[e])):0===(r=await (0,c.query)("SELECT id FROM carts WHERE session_id = $1",[t])).rows.length&&(r=await (0,c.query)("INSERT INTO carts (session_id) VALUES ($1) RETURNING id",[t])),r.rows[0]}let p=(0,o.l)(s,"default"),m=(0,o.l)(s,"config"),P=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/cart",pathname:"/api/cart",bundlePath:"",filename:""},userland:s})},51004:(e,t,r)=>{r.r(t),r.d(t,{createUser:()=>o,default:()=>p,getCategories:()=>g,getCategoryBySlug:()=>l,getConnection:()=>a,getProductBySlug:()=>E,getProducts:()=>y,getUserByEmail:()=>i,getUserById:()=>c,pool:()=>d,query:()=>s,transaction:()=>n,updateUser:()=>u});let s=async(e,t=[])=>(console.log(`Database query: ${e}`,t),{rows:[],rowCount:0}),a=async()=>(console.log("Getting database connection"),{query:s,release:()=>console.log("Connection released")}),n=async e=>{console.log("Starting database transaction");let t=await a();try{await t.query("BEGIN");let r=await e(t);return await t.query("COMMIT"),r}catch(e){throw await t.query("ROLLBACK"),e}finally{t.release()}},o=async e=>(console.log("Creating user:",e),{id:"mock-user-id",...e}),i=async e=>(console.log("Getting user by email:",e),null),c=async e=>(console.log("Getting user by ID:",e),null),u=async(e,t)=>(console.log("Updating user:",e,t),{id:e,...t}),d={query:async(e,t=[])=>(console.log(`Pool query: ${e}`,t),{rows:[],rowCount:0}),connect:async()=>(console.log("Pool connection established"),{query:async(e,t=[])=>(console.log(`Connection query: ${e}`,t),{rows:[],rowCount:0}),release:()=>console.log("Connection released")})},l=async e=>(console.log(`Getting category by slug: ${e}`),{id:1,name:"iPhone Parts",slug:e,description:"High-quality iPhone replacement parts"}),g=async()=>(console.log("Getting all categories"),[{id:1,name:"iPhone Parts",slug:"iphone-parts"},{id:2,name:"Samsung Parts",slug:"samsung-parts"},{id:3,name:"iPad Parts",slug:"ipad-parts"},{id:4,name:"Tools",slug:"tools"}]),y=async(e={})=>(console.log("Getting products with filters:",e),[{id:1,name:"iPhone 15 Pro Screen",slug:"iphone-15-pro-screen",price:299.99,category:"iPhone Parts"},{id:2,name:"Samsung S24 Battery",slug:"samsung-s24-battery",price:89.99,category:"Samsung Parts"}]),E=async e=>(console.log(`Getting product by slug: ${e}`),{id:1,name:"iPhone 15 Pro Screen",slug:e,price:299.99,description:"High-quality OLED screen replacement for iPhone 15 Pro",category:"iPhone Parts"}),p={query:s,getConnection:a,transaction:n,createUser:o,getUserByEmail:i,getUserById:c,updateUser:u,pool:d,getCategoryBySlug:l,getCategories:g,getProducts:y,getProductBySlug:E}},47153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},71802:(e,t,r)=>{e.exports=r(20145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=11845);module.exports=r})();