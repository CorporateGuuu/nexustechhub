"use strict";(()=>{var e={};e.id=6026,e.ids=[6026],e.modules={8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},33480:(e,t,r)=>{e.exports=r(75600)},43919:(e,t,r)=>{r.r(t),r.d(t,{config:()=>d,default:()=>u,routeModule:()=>l});var s={};r.r(s),r.d(s,{default:()=>c});var a=r(33480),o=r(8667),i=r(86435),n=r(91261);async function c(e,t){let{user:r}=await n.Ay.auth.getUser();if(!r&&"GET"!==e.method)return t.status(401).json({success:!1,message:"Authentication required"});let s=r?.id,a=e.cookies.cart_session_id||null;if("GET"===e.method)try{let e;if(s)e=n.Ay.from("carts").select("id").eq("user_id",s).single();else{if(!a)return t.status(200).json({success:!0,cart:{items:[],subtotal:0,item_count:0}});e=n.Ay.from("carts").select("id").eq("session_id",a).single()}let{data:r,error:o}=await e;if(o&&"PGRST116"!==o.code)throw o;if(!r)return t.status(200).json({success:!0,cart:{items:[],subtotal:0,item_count:0}});let{data:i,error:c}=await n.Ay.from("cart_items").select(`
          id,
          quantity,
          price_at_addition,
          products (
            id,
            name,
            slug,
            price,
            discount_percentage,
            image_url,
            stock_quantity
          )
        `).eq("cart_id",r.id);if(c)throw c;let u=i.map(e=>{let t=e.products,r=t.discount_percentage?parseFloat((t.price*(1-t.discount_percentage/100)).toFixed(2)):parseFloat(t.price);return{id:e.id,product_id:t.id,name:t.name,slug:t.slug,price:parseFloat(t.price),discount_percentage:parseFloat(t.discount_percentage||0),discounted_price:r,image_url:t.image_url,quantity:e.quantity,total:parseFloat((r*e.quantity).toFixed(2))}}),d=u.reduce((e,t)=>e+t.total,0),l=u.reduce((e,t)=>e+t.quantity,0);return t.status(200).json({success:!0,cart:{id:r.id,items:u,subtotal:parseFloat(d.toFixed(2)),item_count:l}})}catch(e){return console.error("Error fetching cart:",e),t.status(500).json({success:!1,message:"Error fetching cart",error:e.message})}if("POST"===e.method)try{let r,{product_id:o,quantity:i=1}=e.body;if(!o)return t.status(400).json({success:!1,message:"Product ID is required"});let{data:c,error:u}=await n.Ay.from("products").select("id, price, discount_percentage, stock_quantity").eq("id",o).single();if(u)throw u;if(!c)return t.status(404).json({success:!1,message:"Product not found"});if(c.stock_quantity<i)return t.status(400).json({success:!1,message:"Not enough stock available"});let{data:d,error:l}=await n.Ay.from("carts").select("id").eq(s?"user_id":"session_id",s||a).single();if(l&&"PGRST116"!==l.code)throw l;if(d)r=d.id;else{let{data:e,error:t}=await n.Ay.from("carts").insert([s?{user_id:s}:{session_id:a}]).select("id").single();if(t)throw t;r=e.id}let{data:m,error:g}=await n.Ay.from("cart_items").select("id, quantity").eq("cart_id",r).eq("product_id",o).single();if(g&&"PGRST116"!==g.code)throw g;let p=c.discount_percentage?parseFloat((c.price*(1-c.discount_percentage/100)).toFixed(2)):parseFloat(c.price);if(m){let e=m.quantity+i;if(c.stock_quantity<e)return t.status(400).json({success:!1,message:"Not enough stock available"});let{error:r}=await n.Ay.from("cart_items").update({quantity:e}).eq("id",m.id);if(r)throw r}else{let{error:e}=await n.Ay.from("cart_items").insert([{cart_id:r,product_id:o,quantity:i,price_at_addition:p}]);if(e)throw e}return t.status(200).json({success:!0,message:"Product added to cart",cart_id:r})}catch(e){return console.error("Error adding to cart:",e),t.status(500).json({success:!1,message:"Error adding to cart",error:e.message})}if("PUT"===e.method)try{let{item_id:r,quantity:o}=e.body;if(!r||!o)return t.status(400).json({success:!1,message:"Item ID and quantity are required"});let{data:i,error:c}=await n.Ay.from("cart_items").select(`
          id,
          cart_id,
          product_id,
          products (stock_quantity)
        `).eq("id",r).single();if(c)throw c;let{data:u,error:d}=await n.Ay.from("carts").select("id").eq("id",i.cart_id).eq(s?"user_id":"session_id",s||a).single();if(d)throw d;if(!u)return t.status(403).json({success:!1,message:"Not authorized to update this cart item"});if(i.products.stock_quantity<o)return t.status(400).json({success:!1,message:"Not enough stock available"});let{error:l}=await n.Ay.from("cart_items").update({quantity:o}).eq("id",r);if(l)throw l;return t.status(200).json({success:!0,message:"Cart item updated"})}catch(e){return console.error("Error updating cart item:",e),t.status(500).json({success:!1,message:"Error updating cart item",error:e.message})}if("DELETE"!==e.method)return t.status(405).json({success:!1,message:"Method not allowed"});try{let{item_id:r}=e.body;if(!r)return t.status(400).json({success:!1,message:"Item ID is required"});let{data:o,error:i}=await n.Ay.from("cart_items").select("id, cart_id").eq("id",r).single();if(i)throw i;let{data:c,error:u}=await n.Ay.from("carts").select("id").eq("id",o.cart_id).eq(s?"user_id":"session_id",s||a).single();if(u)throw u;if(!c)return t.status(403).json({success:!1,message:"Not authorized to delete this cart item"});let{error:d}=await n.Ay.from("cart_items").delete().eq("id",r);if(d)throw d;return t.status(200).json({success:!0,message:"Cart item removed"})}catch(e){return console.error("Error removing cart item:",e),t.status(500).json({success:!1,message:"Error removing cart item",error:e.message})}}let u=(0,i.M)(s,"default"),d=(0,i.M)(s,"config"),l=new a.PagesAPIRouteModule({definition:{kind:o.A.PAGES_API,page:"/api/supabase/cart",pathname:"/api/supabase/cart",bundlePath:"",filename:""},userland:s})},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},86435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},91261:(e,t,r)=>{r.d(t,{Ay:()=>o,zw:()=>a});let s={auth:{signUp:async e=>(console.log("Supabase signUp:",e),{data:{user:{id:"mock-user-id",email:e.email}},error:null}),signInWithPassword:async e=>(console.log("Supabase signIn:",e),{data:{user:{id:"mock-user-id",email:e.email}},error:null}),signOut:async()=>(console.log("Supabase signOut"),{error:null}),getUser:async()=>(console.log("Supabase getUser"),{data:{user:{id:"mock-user-id",email:"demo@example.com"}},error:null})},from:e=>({select:(e="*")=>({eq:(e,t)=>({data:[],error:null}),order:(e,t)=>({data:[],error:null}),limit:e=>({data:[],error:null}),data:[],error:null}),insert:e=>({data:Array.isArray(e)?e:[e],error:null}),update:e=>({eq:(t,r)=>({data:[e],error:null})}),delete:()=>({eq:(e,t)=>({data:[],error:null})})})},a=(e,t)=>(console.log("Creating server Supabase client"),s),o={supabase:s,createClient:(e,t)=>(console.log("Creating Supabase client"),s),createServerSupabaseClient:a,getProducts:async(e={})=>(console.log("Getting products from Supabase:",e),{data:[{id:1,name:"iPhone 15 Pro Screen Assembly",price:299.99,stock:25,category:"iPhone Parts",image:"/images/products/iphone-15-pro-screen.jpg"},{id:2,name:"Samsung Galaxy S24 Battery",price:89.99,stock:50,category:"Samsung Parts",image:"/images/products/samsung-s24-battery.jpg"}],error:null}),getProduct:async e=>(console.log(`Getting product ${e} from Supabase`),{data:{id:e,name:"iPhone 15 Pro Screen Assembly",price:299.99,stock:25,category:"iPhone Parts",description:"High-quality OLED screen assembly for iPhone 15 Pro",image:"/images/products/iphone-15-pro-screen.jpg"},error:null}),createProduct:async e=>(console.log("Creating product in Supabase:",e),{data:{id:Date.now(),...e,created_at:new Date().toISOString()},error:null}),updateProduct:async(e,t)=>(console.log(`Updating product ${e} in Supabase:`,t),{data:{id:e,...t,updated_at:new Date().toISOString()},error:null}),getCart:async e=>(console.log(`Getting cart for user ${e} from Supabase`),{data:[],error:null}),addToCart:async(e,t,r)=>(console.log(`Adding to cart: user ${e}, product ${t}, qty ${r}`),{data:{id:Date.now(),user_id:e,product_id:t,quantity:r,created_at:new Date().toISOString()},error:null}),updateCartItem:async(e,t)=>(console.log(`Updating cart item ${e} to quantity ${t}`),{data:{id:e,quantity:t,updated_at:new Date().toISOString()},error:null}),removeFromCart:async e=>(console.log(`Removing cart item ${e}`),{data:null,error:null})}}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=43919);module.exports=r})();