"use strict";(()=>{var e={};e.id=4494,e.ids=[4494],e.modules={67096:e=>{e.exports=require("bcrypt")},73227:e=>{e.exports=require("next-auth")},62113:e=>{e.exports=require("next-auth/next")},47449:e=>{e.exports=require("next-auth/providers/credentials")},93598:e=>{e.exports=require("next-auth/providers/google")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},8678:e=>{e.exports=import("pg")},64911:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{config:()=>l,default:()=>d,routeModule:()=>m});var a=t(71802),n=t(47153),i=t(56249),o=t(27394),u=e([o]);o=(u.then?(await u)():u)[0];let d=(0,i.l)(o,"default"),l=(0,i.l)(o,"config"),m=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/user/2fa/send-test",pathname:"/api/user/2fa/send-test",bundlePath:"",filename:""},userland:o});r()}catch(e){r(e)}})},27394:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{default:()=>d});var a=t(62113),n=t(45884),i=t(33739),o=t(8678),u=e([o]);let l=new(o=(u.then?(await u)():u)[0]).Pool({connectionString:process.env.DATABASE_URL||"postgresql://postgres:postgres@localhost:5432/mdtstech_store",ssl:{rejectUnauthorized:!1}});async function d(e,s){let t=await (0,a.getServerSession)(e,s,n.authOptions);if(!t)return s.status(401).json({message:"Unauthorized"});let r=t.user.id;if("POST"===e.method)try{let{method:t}=e.body;if(!t||!["email","sms"].includes(t))return s.status(400).json({message:"Invalid verification method"});let a=`
        SELECT email, phone_number FROM users
        WHERE id = $1
      `,n=await l.query(a,[r]);if(0===n.rows.length)return s.status(404).json({message:"User not found"});let o=n.rows[0],u=!1;if("email"===t){if(!o.email)return s.status(400).json({message:"User does not have an email address"});u=await (0,i.sendEmailVerification)(r,o.email)}else if("sms"===t){if(!o.phone_number)return s.status(400).json({message:"User does not have a phone number"});u=await (0,i.sendSmsVerification)(r,o.phone_number)}if(!u)return s.status(500).json({message:`Failed to send ${t} verification`});return s.status(200).json({message:`Test ${t} verification sent successfully`})}catch(e){return console.error("Error sending test verification:",e),s.status(500).json({message:"Internal server error"})}return s.status(405).json({message:"Method not allowed"})}r()}catch(e){r(e)}})}};var s=require("../../../../webpack-api-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[8074],()=>t(64911));module.exports=r})();