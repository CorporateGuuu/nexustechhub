(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7313],{66473:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/auth/2fa",function(){return o(40250)}])},40250:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return p}});var a=o(85893),n=o(67294),r=o(11163),i=o(33299),s=o(9008),c=o.n(s),u=o(91435),d=o.n(u),_=e=>{let{userId:t,email:o,methods:s,callbackUrl:c}=e,[u,_]=(0,n.useState)((null==s?void 0:s.preferred_method)||"email"),[h,l]=(0,n.useState)(["","","","","",""]),[p,f]=(0,n.useState)(""),[m,g]=(0,n.useState)(!1),[w,A]=(0,n.useState)(""),[T,v]=(0,n.useState)(0),[F,y]=(0,n.useState)(!1),[C,j]=(0,n.useState)(null),k=(0,n.useRef)([]),x=(0,r.useRouter)();(0,n.useEffect)(()=>{"email"===u||"sms"===u?N(u):"duo"===u&&b()},[u]),(0,n.useEffect)(()=>{if(T>0){let e=setTimeout(()=>v(T-1),1e3);return()=>clearTimeout(e)}},[T]);let b=async()=>{try{g(!0),A("");let e=await fetch("/api/auth/2fa/duo-init",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t})});if(e.ok){let t=await e.json();j(t),window.Duo&&window.Duo.init({host:t.host,sig_request:t.sigRequest,iframe:"duo-iframe"})}else{let t=await e.json();A(t.message||"Failed to initialize DUO authentication")}}catch(e){A("An error occurred while initializing DUO authentication"),console.error(e)}finally{g(!1)}},N=async e=>{try{g(!0),A("");let o=await fetch("/api/auth/2fa/send-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t,method:e})});if(o.ok)v(60);else{let t=await o.json();A(t.message||"Failed to send ".concat(e," verification code"))}}catch(t){A("An error occurred while sending ".concat(e," verification code")),console.error(t)}finally{g(!1)}},P=(e,t)=>{if(t&&!/^\d+$/.test(t))return;let o=[...h];o[e]=t,l(o),t&&e<5&&k.current[e+1].focus()},S=(e,t)=>{"Backspace"===t.key&&!h[e]&&e>0&&k.current[e-1].focus()},B=async()=>{try{g(!0),A("");let e=h.join("");if(6!==e.length){A("Please enter a 6-digit verification code"),g(!1);return}let o=await fetch("/api/auth/2fa/verify-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t,method:u,code:e})});if(o.ok){let e=await (0,i.signIn)("2fa-completion",{redirect:!1,userId:t,twoFactorVerified:!0});e.error?A(e.error):x.push(c||"/")}else{let e=await o.json();A(e.message||"Invalid verification code")}}catch(e){A("An error occurred while verifying the code"),console.error(e)}finally{g(!1)}},L=async()=>{try{if(g(!0),A(""),!p||p.length<8){A("Please enter a valid backup code"),g(!1);return}let e=await fetch("/api/auth/2fa/verify-backup-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t,code:p})});if(e.ok){let e=await (0,i.signIn)("2fa-completion",{redirect:!1,userId:t,twoFactorVerified:!0});e.error?A(e.error):x.push(c||"/")}else{let t=await e.json();A(t.message||"Invalid backup code")}}catch(e){A("An error occurred while verifying the backup code"),console.error(e)}finally{g(!1)}};return(0,a.jsxs)("div",{className:d().verificationContainer,children:[(0,a.jsx)("h2",{children:"Two-Factor Authentication"}),(0,a.jsx)("p",{className:d().verificationDescription,children:"For added security, please verify your identity with a second factor."}),w&&(0,a.jsx)("div",{className:d().error,children:w}),F?(0,a.jsxs)("div",{className:d().backupCodeForm,children:[(0,a.jsx)("p",{children:"Enter one of your backup codes:"}),(0,a.jsx)("input",{type:"text",className:d().backupCodeInput,value:p,onChange:e=>f(e.target.value.toUpperCase()),placeholder:"Enter backup code",maxLength:10}),(0,a.jsx)("button",{className:d().verifyButton,onClick:L,disabled:m||!p,children:m?"Verifying...":"Verify Backup Code"}),(0,a.jsx)("div",{className:d().resendContainer,children:(0,a.jsx)("span",{className:d().resendLink,onClick:()=>y(!1),children:"Back to verification methods"})})]}):"duo"===u?(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{children:"Complete the DUO authentication process:"}),(0,a.jsx)("div",{className:d().duoContainer,children:(0,a.jsx)("iframe",{id:"duo-iframe",width:"100%",height:"330",frameBorder:"0",title:"DUO Authentication","data-host":null==C?void 0:C.host,"data-sig-request":null==C?void 0:C.sigRequest})})]}):(0,a.jsxs)("div",{className:d().verificationForm,children:[(0,a.jsxs)("p",{children:["Enter the 6-digit verification code sent to your ","email"===u?"email":"phone",":"]}),(0,a.jsx)("div",{className:d().codeInput,onPaste:e=>{e.preventDefault();let t=e.clipboardData.getData("text");/^\d{6}$/.test(t)&&(l(t.split("")),k.current[5].focus())},children:h.map((e,t)=>(0,a.jsx)("input",{type:"text",maxLength:1,value:e,onChange:e=>P(t,e.target.value),onKeyDown:e=>S(t,e),ref:e=>k.current[t]=e,autoFocus:0===t},t))}),(0,a.jsx)("button",{className:d().verifyButton,onClick:B,disabled:m||h.some(e=>!e),children:m?"Verifying...":"Verify Code"}),(0,a.jsx)("div",{className:d().resendContainer,children:T>0?(0,a.jsxs)("span",{children:["Resend code in ",(0,a.jsxs)("span",{className:d().countdown,children:[T,"s"]})]}):(0,a.jsx)("span",{className:d().resendLink,onClick:()=>N(u),children:"Resend verification code"})})]}),!F&&(0,a.jsxs)("div",{className:d().alternativeMethod,children:[(0,a.jsx)("h3",{children:"Verification Methods"}),(0,a.jsxs)("div",{children:[(null==s?void 0:s.email_enabled)&&(0,a.jsx)("button",{className:d().methodButton,onClick:()=>_("email"),disabled:"email"===u,children:"Email"}),(null==s?void 0:s.sms_enabled)&&(0,a.jsx)("button",{className:d().methodButton,onClick:()=>_("sms"),disabled:"sms"===u,children:"SMS"}),(null==s?void 0:s.duo_enabled)&&(0,a.jsx)("button",{className:d().methodButton,onClick:()=>_("duo"),disabled:"duo"===u,children:"DUO Security"})]}),(0,a.jsx)("span",{className:d().backupCodeLink,onClick:()=>y(!0),children:"Use a backup code"})]})]})},h=o(59235),l=o.n(h);function p(){let[e,t]=(0,n.useState)(!0),[o,s]=(0,n.useState)(""),[u,d]=(0,n.useState)(null),[h,p]=(0,n.useState)(""),[f,m]=(0,n.useState)(null),g=(0,r.useRouter)(),{callbackUrl:w}=g.query;return((0,n.useEffect)(()=>{(async function(){try{let e=await (0,i.getSession)();if(!e){g.replace("/auth/signin");return}if(!e.requiresTwoFactor){g.replace(w||"/");return}d(e.user.id),p(e.user.email),m(e.twoFactorMethods),t(!1)}catch(e){console.error("Error checking session:",e),s("An error occurred while checking your session"),t(!1)}})()},[g,w]),e)?(0,a.jsxs)("div",{className:l().container,children:[(0,a.jsx)(c(),{children:(0,a.jsx)("title",{children:"Two-Factor Authentication | MDTS Tech"})}),(0,a.jsx)("div",{className:l().formContainer,children:(0,a.jsxs)("div",{className:l().loading,children:[(0,a.jsx)("div",{className:l().spinner}),(0,a.jsx)("p",{children:"Loading..."})]})})]}):o?(0,a.jsxs)("div",{className:l().container,children:[(0,a.jsx)(c(),{children:(0,a.jsx)("title",{children:"Two-Factor Authentication | MDTS Tech"})}),(0,a.jsx)("div",{className:l().formContainer,children:(0,a.jsxs)("div",{className:l().error,children:[(0,a.jsx)("p",{children:o}),(0,a.jsx)("button",{className:l().button,onClick:()=>g.push("/auth/signin"),children:"Back to Sign In"})]})})]}):(0,a.jsxs)("div",{className:l().container,children:[(0,a.jsxs)(c(),{children:[(0,a.jsx)("title",{children:"Two-Factor Authentication | MDTS Tech"}),(null==f?void 0:f.duo_enabled)&&(0,a.jsx)("script",{src:"https://api-XXXX.duosecurity.com/frame/hosted/Duo-Web-v2.min.js"})]}),(0,a.jsx)("div",{className:l().formContainer,children:(0,a.jsx)(_,{userId:u,email:h,methods:f,callbackUrl:w})})]})}},91435:function(e){e.exports={twoFactorSetup:"TwoFactorAuth_twoFactorSetup__HyIsT",description:"TwoFactorAuth_description__VX2X1",error:"TwoFactorAuth_error__6om0q",success:"TwoFactorAuth_success__cEzBw",toggleContainer:"TwoFactorAuth_toggleContainer__ETt4Z",toggle:"TwoFactorAuth_toggle__hU6AN",toggleSwitch:"TwoFactorAuth_toggleSwitch___3OIO",slider:"TwoFactorAuth_slider__a02gE",methodsContainer:"TwoFactorAuth_methodsContainer__rYE69",method:"TwoFactorAuth_method__8B8c7",methodDescription:"TwoFactorAuth_methodDescription__V0UFV",testButton:"TwoFactorAuth_testButton__0BKy3",addPhoneLink:"TwoFactorAuth_addPhoneLink__ECIyQ",duoLink:"TwoFactorAuth_duoLink__Kh5_z",preferredMethod:"TwoFactorAuth_preferredMethod__vRlJf",radioGroup:"TwoFactorAuth_radioGroup__qCwKi",radio:"TwoFactorAuth_radio__0jQbC",backupCodes:"TwoFactorAuth_backupCodes__sg8lg",generateButton:"TwoFactorAuth_generateButton__wb6uy",codesContainer:"TwoFactorAuth_codesContainer__USZ60",warning:"TwoFactorAuth_warning___0wlx",codes:"TwoFactorAuth_codes__VHDTn",code:"TwoFactorAuth_code__uC_b2",printButton:"TwoFactorAuth_printButton__FU79P",closeButton:"TwoFactorAuth_closeButton__SGbty",loading:"TwoFactorAuth_loading__932Lk",spinner:"TwoFactorAuth_spinner__mo5NC",spin:"TwoFactorAuth_spin__Ud7VS",verificationContainer:"TwoFactorAuth_verificationContainer__tHKVG",verificationDescription:"TwoFactorAuth_verificationDescription__tQEXg",verificationForm:"TwoFactorAuth_verificationForm__mt4Tf",codeInput:"TwoFactorAuth_codeInput__Tt4JK",verifyButton:"TwoFactorAuth_verifyButton__wEAXB",resendContainer:"TwoFactorAuth_resendContainer__fs3LM",resendLink:"TwoFactorAuth_resendLink__PBmkh",countdown:"TwoFactorAuth_countdown__mL3Kb",alternativeMethod:"TwoFactorAuth_alternativeMethod__unCIl",methodButton:"TwoFactorAuth_methodButton__7g0wL",backupCodeLink:"TwoFactorAuth_backupCodeLink__hzy_k",backupCodeForm:"TwoFactorAuth_backupCodeForm__XbWxp",backupCodeInput:"TwoFactorAuth_backupCodeInput__iTQsW",duoContainer:"TwoFactorAuth_duoContainer__ezP8M",printHide:"TwoFactorAuth_printHide__856IU"}},59235:function(e){e.exports={authMain:"AuthPages_authMain__quRD7",authContainer:"AuthPages_authContainer__WlUa5",authCard:"AuthPages_authCard__GeZyH",authHeader:"AuthPages_authHeader__MArq5",authTitle:"AuthPages_authTitle__TBFmG",authSubtitle:"AuthPages_authSubtitle__Oy597",authForm:"AuthPages_authForm__vB_1b",formGroup:"AuthPages_formGroup___7bmc",formLabel:"AuthPages_formLabel___eybm",formInput:"AuthPages_formInput__EKCCO",error:"AuthPages_error__FVL0_",formError:"AuthPages_formError__NxJQS",primaryBtn:"AuthPages_primaryBtn__NuwlB",secondaryBtn:"AuthPages_secondaryBtn__LH4uE",authLinks:"AuthPages_authLinks__H5GYv",authLink:"AuthPages_authLink__2SWyp",divider:"AuthPages_divider__DxYAq",googleBtn:"AuthPages_googleBtn__5Z6oc",errorIcon:"AuthPages_errorIcon__490Nd",errorContent:"AuthPages_errorContent__KbazK",errorMessage:"AuthPages_errorMessage__SYCj9",userInfo:"AuthPages_userInfo__NB1mh",errorActions:"AuthPages_errorActions__qM6uO",helpSection:"AuthPages_helpSection__eUgQY",contactInfo:"AuthPages_contactInfo__Ony_b",whatsappLink:"AuthPages_whatsappLink__ufoHD",loading:"AuthPages_loading__DPGFI",loadingSpinner:"AuthPages_loadingSpinner__8W2zL",spin:"AuthPages_spin__Z5V52",successMessage:"AuthPages_successMessage__2vvG1"}}},function(e){e.O(0,[2888,9774,179],function(){return e(e.s=66473)}),_N_E=e.O()}]);