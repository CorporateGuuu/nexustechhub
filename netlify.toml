# OpenNext Netlify Configuration - SECURE & PATCHED for React2Shell vulnerabilities
# Updated for Next.js 15.5.7+ with CVE-2025-55182 / CVE-2025-66478 protection

[build]
  command = "npm run build"
  publish = "dist"

[build.environment]
  NODE_VERSION = "20"
  # OpenNext specific environment
  OPENNEXT_VERSION = "latest"

# OpenNext adapter - replaces vulnerable @netlify/plugin-nextjs
[[plugins]]
  package = "@opennextjs/cloudflare"

# Security scan settings
[build.secrets_scan]
  secrets_scan_enabled = true
  omit_keys = [
    "NEXT_PUBLIC_SUPABASE_URL",
    "NEXT_PUBLIC_SUPABASE_ANON_KEY",
    "SUPABASE_SERVICE_ROLE_KEY"
  ]
